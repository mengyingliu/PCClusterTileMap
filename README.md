# PCClusterTileMap
PC集群的负载均衡瓦片生成算法
##项目简介
Webgis中随着瓦片层级的增加，瓦片的数量呈指数增长，针对单机瓦片时效低的问题，提出了PC集群环境下多级比例尺大规模瓦片数据生成的负载均衡并行算法，利用分布式数据存储和节点的本地计算资源，算法通过对瓦片的任务量的预估，实现了面向任务量的负载均衡；同时建立动态反馈机制根据节点的实时计算能力的量化反馈，完成瓦片剩余任务的再分配，实现了瓦片过程中的实时动态负载均衡，有效提高了集群中各节点的利用效率。
##方法流程图
本文提出一种PC集群环境下，面向空间要素内容的地图瓦片负载均衡生成方法，流程如图一。主要分为任务分配和动态反馈两个过程，实现面向空间要素内容的任务均分和节点的主动式动态反馈。
![image](https://raw.githubusercontent.com/mengyingliu/PCClusterTileMap/master/pics/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B.jpg)
##面向空间内容的任务分配流程
在任务分解过程中，首先通过主控节点，即负载均衡器，进行瓦片元参数的初始化，其中元参数主要包括地图原点、瓦片的像素高宽、DPI等信息，生成瓦片方案并统计瓦片的总数目。接下来在地图矢量要素最小外包络范围内进行网格化，并逐行逐列统计网格内空间数据量大小，建立全局的分比例尺级别的空间数据分布信息表。负载均衡器逐行扫描，根据集群内节点的总数目和空间数据分布内容进行空间数据量的平均划分，目的是将地图空间要素内容公平分配到各节点上。由于不同网格内的空间数据内容大小不一，因此各节点将得到相同任务量不同数目的网格。此时节点根据网格数量反算瓦片的实际行列号并将其转换为实际地理范围，任务分配完成
![image](https://github.com/mengyingliu/PCClusterTileMap/blob/master/pics/%E9%9D%A2%E5%90%91%E7%A9%BA%E9%97%B4%E5%86%85%E5%AE%B9%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%88%86%E9%85%8D.jpg)
##算法效率分析
